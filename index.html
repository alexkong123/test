<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,
initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,
user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style"
content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<meta name="browsermode" content="application">
<meta name="x5-page-mode" content="app">
<meta name="x5-orientation" content="portrait">
<meta name="screen-orientation" content="portrait">
<meta name="full-screen" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>95æ•¸èƒŒæ•¸å°æ¸¸æˆ² - å„ªåŒ–ç‰ˆ</title>
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary-gradient: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
  --container-bg: rgba(255, 255, 255, 0.98);
  --primary-color: #3498db;
  --success-color: #2ecc71;
  --error-color: #e74c3c;
  --warning-color: #f39c12;
  --text-primary: #2c3e50;
  --text-secondary: #7f8c8d;
  --border-radius: 20px;
  --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --container-max-width: 500px;
  --container-padding: 15px;
  --element-spacing: 10px;
}

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

html {
  font-size: 16px;
  height: 100%;
  overflow: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: 'Segoe UI', 'Microsoft JhengHei', 'PingFang SC',
    'Hiragino Sans GB', 'Arial', sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background: var(--primary-gradient);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
  overscroll-behavior: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.game-container {
  width: 100%;
  max-width: var(--container-max-width);
  height: 100vh;
  max-height: 100vh;
  background: var(--container-bg);
  margin: 0 auto;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

@media (min-width: 481px) {
  .game-container {
    height: 95vh;
    max-height: 95vh;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin: 2.5vh auto;
  }
}

/* ä¿®å¾©å±å¹•åˆ‡æ›å•é¡Œ */
.screen {
  display: none;
  flex: 1;
  flex-direction: column;
  padding: var(--container-padding);
  overflow-y: auto;
  overflow-x: hidden;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.screen.active {
  display: flex;
  opacity: 1;
  transform: translateX(0);
  z-index: 2;
}

.screen:not(.active) {
  opacity: 0;
  transform: translateX(20px);
  pointer-events: none;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  border: none;
  border-radius: 50px;
  font-size: 1rem;
  font-weight: 600;
  line-height: 1;
  text-decoration: none;
  cursor: pointer;
  transition: var(--transition);
  user-select: none;
  touch-action: manipulation;
  position: relative;
  overflow: hidden;
  min-height: 44px;
  gap: 8px;
  background: linear-gradient(45deg, var(--primary-color), #2980b9);
  color: white;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}

.btn:active {
  transform: translateY(1px);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

.keypad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 0 var(--container-padding);
  margin: 20px 0;
}

.key {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--text-primary);
  border: none;
  border-radius: 15px;
  color: white;
  font-size: 1.8rem;
  font-weight: bold;
  cursor: pointer;
  transition: var(--transition);
  touch-action: manipulation;
  user-select: none;
  min-height: 60px;
  position: relative;
  overflow: hidden;
}

.key:active {
  transform: scale(0.95);
  background: #1a252f;
}

.progress-container {
  width: 100%;
  padding: 0 var(--container-padding);
  margin: 20px 0;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: #ecf0f1;
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color),
    var(--success-color));
  border-radius: 4px;
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes bounce {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(3px); }
}

@keyframes zoomIn {
  0% { transform: scale(0.5); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

@media (max-width: 480px) {
  :root {
    --container-padding: 10px;
    --element-spacing: 8px;
  }
  
  .game-container {
    border-radius: 0;
    margin: 0;
  }
  
  .keypad {
    gap: 10px;
  }
  
  .key {
    font-size: 1.6rem;
    min-height: 55px;
  }
  
  .btn {
    padding: 10px 20px;
    font-size: 0.95rem;
    min-height: 44px;
  }
}

@media (max-width: 360px) {
  :root {
    --container-padding: 8px;
  }
  
  .keypad {
    gap: 8px;
  }
  
  .key {
    min-height: 50px;
    font-size: 1.5rem;
  }
}

@media screen and (-webkit-tb-dark) {
  body {
    -webkit-tap-highlight-color: transparent;
  }
  
  .btn:active,
  .key:active {
    transition-duration: 0.1s;
  }
}

@supports (-webkit-touch-callout: none) and (not
  (-webkit-overflow-scrolling: touch)) {
  .game-container {
    height: 100vh;
    max-height: -webkit-fill-available;
  }
}

@supports (padding: max(0px)) {
  .game-container {
    padding-left: max(var(--container-padding), env(safe-area-inset-left));
    padding-right: max(var(--container-padding),
      env(safe-area-inset-right));
    padding-top: max(var(--container-padding), env(safe-area-inset-top));
    padding-bottom: max(var(--container-padding),
      env(safe-area-inset-bottom));
  }
}

.sound-toggle {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 100;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  -webkit-tap-highlight-color: transparent;
}

.bgm-toggle {
  position: absolute;
  top: 15px;
  right: 60px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 100;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  -webkit-tap-highlight-color: transparent;
}

.back-home-btn {
  position: absolute;
  top: 15px;
  left: 15px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 100;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: var(--transition);
  -webkit-tap-highlight-color: transparent;
}

.question-container {
  background: linear-gradient(135deg, #f5f7fa, #e4e7f0);
  border-radius: 15px;
  padding: 15px;
  margin: 15px 10px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 120px;
}

.question {
  font-size: 3.2rem;
  font-weight: bold;
  margin: 0;
  color: var(--text-primary);
  text-align: center;
  letter-spacing: 1px;
  font-family: 'Arial', sans-serif;
  word-break: break-all;
}

.answer-input {
  width: 90%;
  padding: 18px;
  font-size: 1.8rem;
  text-align: center;
  background: #f8f9fa;
  border: 2px solid #e0e0e0;
  border-radius: 15px;
  color: var(--text-primary);
  margin-bottom: 15px;
  transition: var(--transition);
  outline: none;
  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
  min-height: 60px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.instructions {
  background: #e3f2fd;
  padding: 12px;
  border-radius: 15px;
  margin: 12px 0;
  text-align: left;
  font-size: 0.85rem;
  color: #1a237e;
}

.mode-card {
  background: white;
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid #e0e0e0;
}

.difficulty-option {
  background: white;
  border-radius: 12px;
  padding: 15px;
  margin: 10px 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid #e0e0e0;
}

.player-info-container {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 12px;
  margin: 5px 0 10px 0;
  text-align: left;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.incorrect-grid {
  display: flex;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 8px 5px;
  gap: 8px;
  scrollbar-width: thin;
  scrollbar-color: var(--primary-color) #f1f1f1;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  height: 160px;
  -ms-overflow-style: -ms-autohiding-scrollbar;
}

.incorrect-grid-item {
  flex: 0 0 auto;
  width: 180px;
  background: white;
  border-radius: 10px;
  padding: 15px 12px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
  border: 2px solid var(--error-color);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  transition: var(--transition);
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: white;
  border-radius: 15px;
  width: 90%;
  max-width: 400px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.pulse {
  animation: pulse 0.3s ease;
}

.wx-tip {
  background: #e1f5fe;
  border-radius: 10px;
  padding: 8px 12px;
  font-size: 0.8rem;
  color: #0277bd;
  margin-top: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.subtitle {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-bottom: 10px;
}

.timer {
  font-size: 0.85rem;
  margin: 6px 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  color: var(--text-secondary);
}

.challenge-timer {
  font-size: 0.9rem;
  padding: 6px 12px;
  background: rgba(231, 76, 60, 0.15);
  color: var(--error-color);
  border-radius: 50px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.result-badge {
  font-size: 2.5rem;
  margin: 5px 0 10px 0;
  animation: zoomIn 0.5s ease;
}

.nickname-container {
  background: linear-gradient(135deg, #f5f7fa, #e4e7f0);
  border-radius: 15px;
  padding: 20px;
  margin: 20px 10px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
}

.nickname-input {
  width: 100%;
  padding: 15px;
  font-size: 1.2rem;
  text-align: center;
  background: #f8f9fa;
  border: 2px solid #e0e0e0;
  border-radius: 15px;
  color: var(--text-primary);
  margin: 15px 0;
  transition: var(--transition);
  outline: none;
  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
}

.incorrect-empty {
  text-align: center;
  padding: 20px 15px;
  background: #e8f5e9;
  border-radius: 10px;
  color: #2e7d32;
  font-size: 0.9rem;
  margin: 10px 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 140px;
}

.control-btn {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 10px;
  padding: 0 var(--container-padding);
  width: 100%;
}

h1 {
  margin-top: 10px;
  font-size: 2rem;
  color: var(--text-primary);
  text-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
  margin-bottom: 5px;
  word-break: break-word;
  overflow-wrap: break-word;
}

.player-info-item {
  margin: 6px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.player-info-label {
  color: var(--text-secondary);
  font-size: 0.85rem;
}

.player-info-value {
  color: var(--text-primary);
  font-weight: 600;
  font-size: 0.9rem;
}

.incorrect-grid-container {
  margin: 10px 0 5px 0;
  position: relative;
  flex: 1;
  min-height: 180px;
}

.incorrect-grid-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 10px;
  font-size: 0.95rem;
  color: var(--text-primary);
}

.incorrect-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 28px;
  height: 28px;
  background: rgba(52, 152, 219, 0.8);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  cursor: pointer;
  z-index: 5;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
  transition: var(--transition);
}

.incorrect-nav.left {
  left: -8px;
}

.incorrect-nav.right {
  right: -8px;
}

.incorrect-grid-scroll-hint {
  display: none;
  font-size: 0.7rem;
  color: var(--primary-color);
  margin-top: 8px;
  text-align: center;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.incorrect-grid-number {
  font-size: 2.2rem;
  font-weight: bold;
  color: var(--error-color);
  margin-bottom: 4px;
  line-height: 1.1;
}

.incorrect-grid-answer {
  font-size: 1.6rem;
  color: var(--text-primary);
  margin-bottom: 2px;
  line-height: 1.1;
}

.incorrect-grid-correct {
  font-size: 1.4rem;
  color: var(--success-color);
  font-weight: 600;
  line-height: 1.1;
}

.incorrect-grid-label {
  font-size: 0.7rem;
  color: var(--text-secondary);
  margin-top: 2px;
  line-height: 1.1;
}

.share-btn {
  background: linear-gradient(45deg, var(--success-color), #27ae60);
  color: white;
  border: none;
  padding: 14px 20px;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 50px;
  cursor: pointer;
  margin-top: 15px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
  width: 90%;
  max-width: 300px;
}

.nickname-hint {
  font-size: 0.8rem;
  color: var(--text-secondary);
  margin-top: 10px;
}

.share-intro {
  margin-bottom: 20px;
}

.share-text {
  background: #f5f5f5;
  padding: 15px;
  border-radius: 8px;
  margin: 15px 0;
  font-size: 0.9rem;
  word-break: break-all;
  text-align: left;
  border: 1px solid #e0e0e0;
  min-height: 80px;
}

.copy-btn {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 50px;
  font-size: 0.9rem;
  cursor: pointer;
  margin-top: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  transition: var(--transition);
}

.close-btn {
  background: #7f8c8d;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 50px;
  font-size: 0.9rem;
  cursor: pointer;
  margin-top: 20px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  transition: var(--transition);
}

.wx-instructions {
  margin-top: 20px;
  text-align: left;
  background: #e3f2fd;
  padding: 15px;
  border-radius: 8px;
  font-size: 0.85rem;
}

.share-info {
  background: #e8f5e9;
  padding: 12px;
  border-radius: 8px;
  margin: 15px 0;
  text-align: left;
}

.score-display, .accuracy-display {
  margin: 8px 0;
  font-weight: bold;
}

.mode-card.practice {
  background: linear-gradient(to bottom right, #e3f2fd, #bbdefb);
}

.mode-card.challenge {
  background: linear-gradient(to bottom right, #ffebee, #ffcdd2);
}

.mode-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  border-color: var(--primary-color);
}

.difficulty-option:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  border-color: var(--primary-color);
}

.answer-input:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.nickname-input:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.back-home-btn:hover {
  background: var(--primary-color);
  color: white;
  transform: scale(1.1);
}

.back-home-btn:active {
  transform: scale(0.95);
}

.incorrect-nav:hover {
  background: #2980b9;
  transform: translateY(-50%) scale(1.05);
}

.incorrect-grid-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
}

.incorrect-grid-scroll-hint i {
  animation: bounce 1.5s infinite;
}

.copy-btn:hover {
  background: #2980b9;
  transform: translateY(-2px);
}

.close-btn:hover {
  background: #95a5a6;
}

.share-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

.result-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding-bottom: 5px;
  max-height: calc(95vh - 150px);
}

.result-footer {
  margin-top: auto;
  padding-top: 10px;
  border-top: 1px solid #eee;
}

#result-screen {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-top: 15px;
  padding-bottom: 15px;
}

#result-screen h1 {
  margin-top: 5px;
  margin-bottom: 10px;
  font-size: 1.8rem;
}

.score {
  font-size: 1.2rem !important;
  margin: 8px 0 !important;
}

.score span {
  font-size: 1.5rem !important;
}

.accuracy {
  font-size: 1rem !important;
  margin-bottom: 12px !important;
}

.accuracy span {
  font-size: 1.3rem !important;
}

#restart-btn {
  background: linear-gradient(45deg, var(--warning-color), #e67e22);
  display: flex;
  align-items: center;
  justify-content: center;
}

#restart-btn i {
  display: none;
}

.incorrect-grid-item > *:not(:last-child) {
  margin-bottom: 3px;
}

.incorrect-grid::-webkit-scrollbar {
  height: 4px;
}

.incorrect-grid::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 2px;
}

.incorrect-grid::-webkit-scrollbar-thumb {
  background: var(--primary-color);
  border-radius: 2px;
}

.incorrect-grid::-webkit-scrollbar-thumb:hover {
  background: #2980b9;
}

@media (max-width: 480px) {
  .sound-toggle {
    top: 10px;
    right: 10px;
  }
  
  .bgm-toggle {
    right: 55px;
    top: 10px;
  }
  
  .back-home-btn {
    top: 8px;
    left: 8px;
    width: 32px;
    height: 32px;
  }
  
  .question-container {
    padding: 10px;
    min-height: 100px;
    margin: 10px 5px;
  }
  
  .question {
    font-size: 2.5rem;
  }
  
  .answer-input {
    padding: 14px;
    font-size: 1.6rem;
    width: 95%;
    min-height: 55px;
  }
  
  .challenge-timer {
    font-size: 0.8rem;
  }
  
  .difficulty-option {
    font-size: 0.95rem;
    padding: 12px;
    margin: 8px 0;
  }
  
  .modal-content {
    width: 95%;
    padding: 15px;
    max-width: 95%;
  }
  
  .nickname-container {
    padding: 15px;
    margin: 15px 5px;
  }
  
  .nickname-input {
    padding: 12px;
    font-size: 1.1rem;
  }
  
  #result-screen {
    padding: 5px;
  }
  
  #result-screen h1 {
    font-size: 1.5rem;
    margin-top: 5px;
    margin-bottom: 8px;
  }
  
  .player-info-container {
    padding: 10px;
    margin: 5px 0 8px 0;
  }
  
  .player-info-item {
    margin: 5px 0;
  }
  
  .player-info-label {
    font-size: 0.8rem;
  }
  
  .player-info-value {
    font-size: 0.85rem;
  }
  
  .result-badge {
    font-size: 2rem;
    margin: 5px 0 8px 0;
  }
  
  .score {
    font-size: 1.1rem !important;
    margin: 6px 0 !important;
  }
  
  .score span {
    font-size: 1.3rem !important;
  }
  
  .accuracy {
    font-size: 0.95rem !important;
    margin-bottom: 10px !important;
  }
  
  .accuracy span {
    font-size: 1.2rem !important;
  }
  
  .timer {
    font-size: 0.85rem !important;
    margin-bottom: 6px !important;
  }
  
  .incorrect-grid-container {
    margin: 8px 0 5px 0;
    min-height: 160px;
  }
  
  .incorrect-grid-title {
    font-size: 0.9rem;
    margin-bottom: 8px;
  }
  
  .incorrect-grid {
    height: 150px;
    padding: 6px 4px;
    gap: 6px;
  }
  
  .incorrect-grid-item {
    width: 160px;
    padding: 12px 10px;
  }
  
  .incorrect-grid-number {
    font-size: 2rem;
    margin-bottom: 3px;
  }
  
  .incorrect-grid-answer {
    font-size: 1.4rem;
    margin-bottom: 1px;
  }
  
  .incorrect-grid-correct {
    font-size: 1.2rem;
  }
  
  .incorrect-grid-label {
    font-size: 0.65rem;
    margin-top: 1px;
  }
  
  .incorrect-grid-item > *:not(:last-child) {
    margin-bottom: 2px;
  }
  
  .incorrect-empty {
    padding: 15px 12px;
    height: 130px;
    font-size: 0.85rem;
  }
  
  .incorrect-nav {
    width: 24px;
    height: 24px;
  }
  
  .incorrect-nav.left {
    left: -5px;
  }
  
  .incorrect-nav.right {
    right: -5px;
  }
  
  .incorrect-nav i {
    font-size: 0.7rem;
  }
  
  .result-footer {
    padding-top: 8px;
    margin-top: 8px;
  }
  
  .share-btn {
    padding: 10px 16px;
    font-size: 0.9rem;
    width: 95%;
    margin-top: 8px;
  }
  
  .keypad {
    gap: 10px;
    padding: 0 10px;
  }
}

@media (max-width: 360px) {
  .incorrect-grid-item {
    width: 150px;
    padding: 10px 8px;
  }
  
  .incorrect-grid-number {
    font-size: 1.8rem;
  }
  
  .incorrect-grid-answer {
    font-size: 1.3rem;
  }
  
  .incorrect-grid-correct {
    font-size: 1.1rem;
  }
  
  .player-info-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
  }
  
  .player-info-label, .player-info-value {
    font-size: 0.75rem;
  }
  
  .key {
    padding: 14px 5px;
    font-size: 1.5rem;
    min-height: 50px;
  }
  
  .keypad {
    gap: 8px;
    padding: 0 8px;
  }
}
</style>
</head>
<body>
<div class="sound-toggle" id="sound-toggle">
  <i class="fas fa-volume-up" id="sound-icon"></i>
</div>
<div class="bgm-toggle" id="bgm-toggle">
  <i class="fas fa-music" id="bgm-icon"></i>
</div>
<div class="game-container">
  <!-- é¦–é  -->
  <div id="home-screen" class="screen active">
    <div>
      <h1>95æ•¸èƒŒæ•¸å°æ¸¸æˆ²</h1>
      <div class="subtitle">æå‡å¿ƒç®—èƒ½åŠ› Â· è¨“ç·´å¿«é€Ÿåæ‡‰</div>
      <div class="instructions">
        <h3><i class="fas fa-info-circle"></i> éŠæˆ²èªªæ˜</h3>
        <p>1. éš¨æ©Ÿå‡ºç¾100-9900çš„æ•´ç™¾ä½æ•¸</p>
        <p>2. å¿«é€Ÿè¼¸å…¥è©²æ•¸çš„95æ•¸çµæœ</p>
        <p>3. ä½¿ç”¨ä¸‹æ–¹æ•¸å­—éµç›¤è¼¸å…¥ç­”æ¡ˆ</p>
        <p>4. å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå¯æŸ¥çœ‹æˆç¸¾å’ŒéŒ¯é¡Œ</p>
        <p> ç¤ºä¾‹ï¼š100 â†’ 95ï¼Œ200 â†’ 190</p>
        <p>é¸æ“‡ç·´ç¿’æ¨¡å¼å¯ä»¥è‡ªç”±ç·´ç¿’ï¼ŒæŒ‘æˆ°æ¨¡å¼å‰‡æœ‰æ™‚é–“é™åˆ¶</p>
      </div>
      <div class="mode-card practice" id="practice-mode">
        <h2><i class="fas fa-book-open"></i> ç·´ç¿’æ¨¡å¼</h2>
        <p>ç„¡æ™‚é–“å£“åŠ›ï¼Œè‡ªç”±ç·´ç¿’å¿ƒç®—èƒ½åŠ›</p>
      </div>
      <div class="mode-card challenge" id="challenge-mode">
        <h2><i class="fas fa-trophy"></i> æŒ‘æˆ°æ¨¡å¼</h2>
        <p>é™æ™‚æŒ‘æˆ°ï¼Œæ¸¬è©¦ä½ çš„åæ‡‰é€Ÿåº¦</p>
      </div>
    </div>
    <div class="wx-tip">
      <i class="fas fa-mobile-alt"></i>
      æç¤ºï¼šæ­¤æ‡‰ç”¨ç”±PIDåˆ¶ä½œï¼ˆAlexkongï¼‰
    </div>
  </div>
  <!-- æš±ç¨±è¼¸å…¥é  -->
  <div id="nickname-screen" class="screen">
    <div class="back-home-btn" id="back-home-nickname">
      <i class="fas fa-arrow-left"></i>
    </div>
    <div>
      <h1><i class="fas fa-user"></i> è¼¸å…¥ç©å®¶æš±ç¨±</h1>
      <div class="subtitle">è«‹è¼¸å…¥æ‚¨çš„æš±ç¨±æˆ–IDï¼Œå°‡é¡¯ç¤ºåœ¨æˆç¸¾å–®ä¸Š</div>
      <div class="nickname-container">
        <div style="margin-bottom: 15px;">
          <i class="fas fa-user-circle" style="font-size: 3rem; color:
            var(--primary-color);"></i>
        </div>
        <input type="text" class="nickname-input" id="nickname-input"
          placeholder="è«‹è¼¸å…¥æš±ç¨± (2-10å€‹å­—ç¬¦)" maxlength="10">
        <div class="nickname-hint">
          <i class="fas fa-info-circle"></i>
          æš±ç¨±å°‡é¡¯ç¤ºåœ¨æˆç¸¾å–®ä¸Šï¼Œå¯ä½¿ç”¨ä¸­æ–‡ã€è‹±æ–‡æˆ–æ•¸å­—
        </div>
      </div>
      <button class="btn" id="confirm-nickname-btn">
        <i class="fas fa-check"></i> ç¢ºèªä¸¦ç¹¼çºŒ
      </button>
    </div>
  </div>
  <!-- ç·´ç¿’æ¨¡å¼é¸æ“‡é  -->
  <div id="practice-screen" class="screen">
    <div class="back-home-btn" id="back-home-practice">
      <i class="fas fa-arrow-left"></i>
    </div>
    <div>
      <h1><i class="fas fa-book-open"></i> ç·´ç¿’æ¨¡å¼</h1>
      <div class="subtitle">é¸æ“‡ç·´ç¿’æ•¸å€¼ç¯„åœ</div>
      <div class="difficulty-option" data-range="1">
        <h3><i class="fas fa-layer-group"></i> 100è‡³1900å…§å®¹</h3>
      </div>
      <div class="difficulty-option" data-range="2">
        <h3><i class="fas fa-layer-group"></i> 2100è‡³3900å…§å®¹</h3>
      </div>
      <div class="difficulty-option" data-range="3">
        <h3><i class="fas fa-layer-group"></i> 4100è‡³5900å…§å®¹</h3>
      </div>
      <div class="difficulty-option" data-range="4">
        <h3><i class="fas fa-layer-group"></i> 6100è‡³7900å…§å®¹</h3>
      </div>
      <div class="difficulty-option" data-range="5">
        <h3><i class="fas fa-layer-group"></i> 8100è‡³9900å…§å®¹</h3>
      </div>
      <!-- æ–°å¢çš„å…©å€‹ç¯„åœ -->
      <div class="difficulty-option" data-range="6">
        <h3><i class="fas fa-layer-group"></i> 100è‡³4900å…§å®¹</h3>
      </div>
      <div class="difficulty-option" data-range="7">
        <h3><i class="fas fa-layer-group"></i> 5100è‡³9900å…§å®¹</h3>
      </div>
    </div>
  </div>
  <!-- æŒ‘æˆ°æ¨¡å¼é¸æ“‡é  -->
  <div id="challenge-screen" class="screen">
    <div class="back-home-btn" id="back-home-challenge">
      <i class="fas fa-arrow-left"></i>
    </div>
    <div>
      <h1><i class="fas fa-trophy"></i> æŒ‘æˆ°æ¨¡å¼</h1>
      <div class="subtitle">é¸æ“‡æŒ‘æˆ°é›£åº¦</div>
      <div class="difficulty-option" data-difficulty="basic">
        <h3><i class="fas fa-star"></i> åŸºç¤æŒ‘æˆ°</h3>
        <p>10ç§’/é¡Œ Â· 30é¡Œ Â· é©åˆæ–°æ‰‹</p>
      </div>
      <div class="difficulty-option" data-difficulty="advanced">
        <h3><i class="fas fa-star-half-alt"></i> é€²éšæŒ‘æˆ°</h3>
        <p>7ç§’/é¡Œ Â· 50é¡Œ Â· ä¸­ç­‰é›£åº¦</p>
      </div>
      <div class="difficulty-option" data-difficulty="expert">
        <h3><i class="fas fa-star"></i> å°ˆå®¶æŒ‘æˆ°</h3>
        <p>5ç§’/é¡Œ Â· 99é¡Œ Â· é«˜æ‰‹å°ˆå±¬</p>
      </div>
    </div>
  </div>
  <!-- éŠæˆ²é  -->
  <div id="game-screen" class="screen">
    <div class="back-home-btn" id="back-home-game">
      <i class="fas fa-home"></i>
    </div>
    <div>
      <h1 id="game-title">95æ•¸èƒŒæ•¸å°æ¸¸æˆ²</h1>
      <div id="challenge-timer-container" style="display: none;">
        <div class="challenge-timer">
          <i class="fas fa-clock"></i> å‰©é¤˜æ™‚é–“: <span
            id="challenge-timer">10</span>ç§’
        </div>
      </div>
      <div class="progress-container">
        <div class="progress-text">ç¬¬ <span
            id="current-question">1</span> é¡Œ / å…± <span
            id="total-questions">10</span> é¡Œ</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width:
            0%"></div>
        </div>
        <div class="timer">
          <i class="fas fa-clock"></i> ç”¨æ™‚: <span
            id="timer">00:00</span>
        </div>
      </div>
      <div class="question-container">
        <div class="question" id="question">100</div>
      </div>
      <input type="text" class="answer-input" id="answer-input"
        placeholder="è¼¸å…¥95æ•¸ç­”æ¡ˆ" readonly>
    </div>
    <div>
      <div class="keypad">
        <button class="key" data-key="1">1</button>
        <button class="key" data-key="2">2</button>
        <button class="key" data-key="3">3</button>
        <button class="key" data-key="4">4</button>
        <button class="key" data-key="5">5</button>
        <button class="key" data-key="6">6</button>
        <button class="key" data-key="7">7</button>
        <button class="key" data-key="8">8</button>
        <button class="key" data-key="9">9</button>
        <button class="key" id="backspace"><i class="fas
            fa-backspace"></i></button>
        <button class="key" data-key="0">0</button>
        <button class="key" id="clear"><i class="fas
            fa-trash-alt"></i></button>
      </div>
      <div class="control-btn">
        <button class="btn" id="next-btn"><i class="fas
            fa-arrow-right"></i> ä¸‹ä¸€é¡Œ</button>
      </div>
    </div>
  </div>
  <!-- çµæœé  -->
  <div id="result-screen" class="screen">
    <div class="back-home-btn" id="back-home-result">
      <i class="fas fa-home"></i>
    </div>
    <div class="result-content">
      <h1>æŒ‘æˆ°å®Œæˆï¼</h1>
      <!-- ç©å®¶è³‡è¨Šé¡¯ç¤ºå€åŸŸ -->
      <div class="player-info-container">
        <div class="player-info-item">
          <span class="player-info-label"><i class="fas fa-user"></i>
            ç©å®¶æš±ç¨±ï¼š</span>
          <span class="player-info-value"
            id="result-nickname">æœªè¨­å®š</span>
        </div>
        <div class="player-info-item">
          <span class="player-info-label"><i class="fas fa-gamepad"></i>
            éŠæˆ²æ¨¡å¼ï¼š</span>
          <span class="player-info-value" id="result-mode">ç·´ç¿’æ¨¡å¼</span>
        </div>
        <div class="player-info-item">
          <span class="player-info-label"><i class="fas
              fa-layer-group"></i> é¸æ“‡é …ç›®ï¼š</span>
          <span class="player-info-value"
            id="result-difficulty">100-1900ç¯„åœ</span>
        </div>
        <div class="player-info-item">
          <span class="player-info-label"><i class="fas
              fa-calendar-alt"></i> å®Œæˆæ™‚é–“ï¼š</span>
          <span class="player-info-value" id="result-datetime">-</span>
        </div>
      </div>
      <div id="result-badge" class="result-badge">
        <i class="fas fa-trophy" style="color: #FFD700;"></i>
      </div>
      <div class="score" style="font-size: 1.4rem; margin: 12px 0;">
        å¾—åˆ†ï¼š<span id="score" style="font-size: 1.8rem;
          color:var(--primary-color);">0</span> / <span id="total"
          style="font-size: 1.8rem;">10</span>
      </div>
      <div class="accuracy" style="font-size: 1.2rem; margin-bottom:
        15px;">
        æ­£ç¢ºç‡ï¼š<span id="accuracy" style="font-size: 1.6rem;
          color:var(--error-color);">0</span>%
      </div>
      <div id="challenge-result" style="display: none;">
        <div class="timer" style="font-size: 1rem; margin-bottom: 12px;">
          <i class="fas fa-stopwatch"></i> å¹³å‡ç­”é¡Œæ™‚é–“: <span
            id="avg-time">0</span>ç§’
        </div>
      </div>
      <div class="timer" style="font-size: 1rem; margin-bottom: 12px;">
        <i class="fas fa-stopwatch"></i> ç¸½ç”¨æ™‚: <span
          id="total-time">00:00</span>
      </div>
      <!-- éŒ¯èª¤è¨˜éŒ„æ»‘å‹•æ–¹æ ¼å€åŸŸ -->
      <div class="incorrect-grid-container">
        <div class="incorrect-grid-title">
          <i class="fas fa-exclamation-triangle"></i> éŒ¯é¡Œè¨˜éŒ„ï¼š
          <span id="incorrect-count" style="color: var(--error-color);
            margin-left: 5px;">0</span>é¡Œ
        </div>
        <div class="incorrect-nav left" id="incorrect-nav-left">
          <i class="fas fa-chevron-left"></i>
        </div>
        <div class="incorrect-grid" id="incorrect-grid">
          <!-- é€™è£¡æœƒå‹•æ…‹ç”ŸæˆéŒ¯é¡Œæ–¹æ ¼ -->
        </div>
        <div class="incorrect-nav right" id="incorrect-nav-right">
          <i class="fas fa-chevron-right"></i>
        </div>
        <div class="incorrect-grid-scroll-hint"
          id="incorrect-scroll-hint">
          <i class="fas fa-arrows-alt-h"></i> å·¦å³æ»‘å‹•æŸ¥çœ‹æ›´å¤š
        </div>
      </div>
      <!-- ç•¶æ²’æœ‰éŒ¯é¡Œæ™‚é¡¯ç¤º -->
      <div id="incorrect-empty" class="incorrect-empty" style="display:
        none;">
        <i class="fas fa-check-circle" style="font-size: 1.8rem;
          margin-bottom: 8px;"></i>
        <p>å¤ªæ£’äº†ï¼å…¨éƒ¨ç­”å°ï¼ğŸ‰</p>
      </div>
    </div>
    <div class="result-footer" style="display: flex; flex-direction:
      column; align-items: center;">
      <button class="btn" id="restart-btn" style="background:
        linear-gradient(45deg, var(--warning-color), #e67e22);">
        å†ç©ä¸€æ¬¡
      </button>
      <button class="share-btn" id="share-btn">
        <i class="fab fa-weixin"></i> åˆ†äº«æˆç¸¾
      </button>
    </div>
  </div>
  <!-- åˆ†äº«æ¨¡æ…‹æ¡† -->
  <div class="modal" id="share-modal">
    <div class="modal-content">
      <h3><i class="fab fa-weixin"></i> åˆ†äº«åˆ°å¾®ä¿¡</h3>
      <div class="share-intro">
        <p>æŒ‘æˆ°95æ•¸èƒŒæ•¸éŠæˆ²ï¼Œæ¸¬è©¦ä½ çš„å¿ƒç®—èƒ½åŠ›ï¼</p>
      </div>
      <div class="share-info">
        <p>æˆ‘çš„æˆç¸¾ï¼š</p>
        <div class="score-display">
          å¾—åˆ†ï¼š<span id="share-score">0</span> / <span
            id="share-total">10</span>
        </div>
        <div class="accuracy-display">
          æ­£ç¢ºç‡ï¼š<span id="share-accuracy">0</span>%
        </div>
      </div>
      <div class="share-text-container">
        <p>åˆ†äº«å…§å®¹ï¼š</p>
        <div class="share-text" id="share-text"></div>
        <button class="copy-btn" id="copy-btn">
          <i class="fas fa-copy"></i> è¤‡è£½åˆ†äº«å…§å®¹
        </button>
      </div>
      <div class="wx-instructions" id="wx-instructions">
        <h4><i class="fas fa-share-alt"></i> å¾®ä¿¡åˆ†äº«æ­¥é©Ÿ</h4>
        <ol>
          <li>é»æ“Šå¾®ä¿¡å³ä¸Šè§’çš„ <strong>"..."</strong> æŒ‰éˆ•</li>
          <li>é¸æ“‡ <strong>"åˆ†äº«åˆ°æœ‹å‹åœˆ"</strong> æˆ–
            <strong>"ç™¼é€çµ¦æœ‹å‹"</strong></li>
          <li>é¸æ“‡è¦åˆ†äº«çš„å¥½å‹æˆ–ç¾¤èŠ</li>
        </ol>
      </div>
      <button class="close-btn" id="close-modal">
        <i class="fas fa-times"></i> é—œé–‰
      </button>
    </div>
  </div>
</div>
<!-- èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å™¨ -->
<audio id="bg-music" loop preload="metadata">
  <source
    src="https://github.com/alexkong123/bg-music-repo/raw/refs/heads/main/ElevateMusica-%20%5BCopyright%20Safe%20Background%20Music%5D.mp3"
    type="audio/mpeg">
</audio>
<script>
(function() {
  'use strict';
  
  const CONFIG = {
    STORAGE_KEY: '95game_data',
    DEFAULT_NICKNAME: 'ç©å®¶',
    ANIMATION_DURATION: 300,
    DEBOUNCE_DELAY: 300
  };
  
  class GameState {
    constructor() {
      this.reset();
    }
    
    reset() {
      this.playerName = localStorage.getItem(`${CONFIG.STORAGE_KEY}_nickname`) || CONFIG.DEFAULT_NICKNAME;
      this.mode = null;
      this.difficulty = null;
      this.practiceRange = null;
      this.totalQuestions = 18;
      this.currentQuestion = 1;
      this.score = 0;
      this.questions = [];
      this.userAnswers = [];
      this.correctAnswers = [];
      this.incorrectList = [];
      this.startTime = null;
      this.elapsedTime = 0;
      this.challengeTimeLeft = 0;
      this.challengeTimes = [];
      this.completionTime = null;
      this._timerInterval = null;
      this._challengeTimerInterval = null;
    }
    
    save() {
      try {
        const data = {
          playerName: this.playerName,
          lastPlayed: Date.now()
        };
        localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
        return true;
      } catch (e) {
        console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', e);
        return false;
      }
    }
    
    load() {
      try {
        const data = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEY));
        if (data && data.playerName) {
          this.playerName = data.playerName;
        }
      } catch (e) {
        console.warn('åŠ è½½æ•°æ®å¤±è´¥:', e);
      }
    }
  }
  
  class GameConfig {
    constructor() {
      this.practiceRanges = {
        1: { min: 100, max: 1900, name: "100è‡³1900å…§å®¹", totalQuestions: 18 },
        2: { min: 2100, max: 3900, name: "2100è‡³3900å…§å®¹", totalQuestions: 18 },
        3: { min: 4100, max: 5900, name: "4100è‡³5900å…§å®¹", totalQuestions: 18 },
        4: { min: 6100, max: 7900, name: "6100è‡³7900å…§å®¹", totalQuestions: 18 },
        5: { min: 8100, max: 9900, name: "8100è‡³9900å…§å®¹", totalQuestions: 18 },
        6: { min: 100, max: 4900, name: "100è‡³4900å…§å®¹", totalQuestions: 45 },
        7: { min: 5100, max: 9900, name: "5100è‡³9900å…§å®¹", totalQuestions: 45 }
      };
      
      this.difficultyNames = {
        basic: "åŸºç¤æŒ‘æˆ°",
        advanced: "é€²éšæŒ‘æˆ°",
        expert: "å°ˆå®¶æŒ‘æˆ°"
      };
      
      this.difficultySettings = {
        basic: { totalQuestions: 30, timePerQuestion: 10 },
        advanced: { totalQuestions: 50, timePerQuestion: 7 },
        expert: { totalQuestions: 99, timePerQuestion: 5 }
      };
    }
  }
  
  class DOMCache {
    constructor() {
      this.elements = new Map();
      this.init();
    }
    
    init() {
      const selectors = [
        '#home-screen', '#nickname-screen', '#practice-screen',
        '#challenge-screen', '#game-screen', '#result-screen',
        '#question', '#answer-input', '#current-question',
        '#total-questions', '#progress-fill', '#timer',
        '#challenge-timer', '#score', '#accuracy',
        '#result-nickname', '#result-mode', '#result-difficulty',
        '#result-datetime', '#incorrect-grid', '#incorrect-empty',
        '#sound-toggle', '#bgm-toggle', '#nickname-input',
        '#game-title', '#challenge-timer-container', '#next-btn',
        '#restart-btn', '#share-btn', '#share-modal',
        '#incorrect-nav-left', '#incorrect-nav-right',
        '#incorrect-scroll-hint', '#incorrect-count',
        '#share-score', '#share-total', '#share-accuracy',
        '#share-text', '#copy-btn', '#close-modal',
        '#wx-instructions', '#back-home-nickname',
        '#back-home-practice', '#back-home-challenge',
        '#back-home-game', '#back-home-result',
        '#confirm-nickname-btn', '#practice-mode',
        '#challenge-mode', '#result-badge', '#total-time',
        '#avg-time', '#challenge-result'
      ];
      
      selectors.forEach(selector => {
        const element = document.querySelector(selector);
        if (element) {
          this.elements.set(selector, element);
        }
      });
    }
    
    get(selector) {
      return this.elements.get(selector);
    }
  }
  
  class ScreenManager {
    constructor(domCache) {
      this.dom = domCache;
      this.currentScreen = null;
      this.screens = new Map();
      this.init();
    }
    
    init() {
      const screenIds = ['home', 'nickname', 'practice', 'challenge', 'game', 'result'];
      screenIds.forEach(id => {
        const screen = this.dom.get(`#${id}-screen`);
        if (screen) {
          this.screens.set(id, screen);
        }
      });
    }
    
    show(screenId, animation = true) {
      const screen = this.screens.get(screenId);
      if (!screen) return;
      
      // éš±è—æ‰€æœ‰å±å¹•
      this.screens.forEach(s => {
        s.classList.remove('active');
      });
      
      // é¡¯ç¤ºç›®æ¨™å±å¹•
      screen.classList.add('active');
      this.currentScreen = screen;
    }
  }
  
  class TimerManager {
    constructor() {
      this.timers = new Map();
    }
    
    setInterval(id, callback, interval) {
      this.clear(id);
      const timerId = setInterval(callback, interval);
      this.timers.set(id, timerId);
      return timerId;
    }
    
    setTimeout(id, callback, delay) {
      this.clear(id);
      const timerId = setTimeout(() => {
        callback();
        this.timers.delete(id);
      }, delay);
      this.timers.set(id, timerId);
      return timerId;
    }
    
    clear(id) {
      const timerId = this.timers.get(id);
      if (timerId) {
        clearInterval(timerId);
        clearTimeout(timerId);
        this.timers.delete(id);
      }
    }
    
    clearAll() {
      this.timers.forEach(timerId => {
        clearInterval(timerId);
        clearTimeout(timerId);
      });
      this.timers.clear();
    }
  }
  
  class AudioManager {
    constructor() {
      this.soundEnabled = true;
      this.bgmEnabled = true;
      this.audioContext = null;
      this.bgMusic = document.getElementById('bg-music');
      this.init();
    }
    
    init() {
      if (window.AudioContext || window.webkitAudioContext) {
        try {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          this.setupBackgroundMusic();
        } catch (e) {
          console.warn('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', e);
        }
      }
    }
    
    setupBackgroundMusic() {
      if (!this.bgMusic) return;
      
      this.bgMusic.volume = 0.1;
      
      const startAudio = () => {
        if (this.bgmEnabled && this.bgMusic.paused) {
          this.bgMusic.play().catch(e => {
            console.log('èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
          });
        }
      };
      
      document.addEventListener('click', startAudio, { once: true });
      document.addEventListener('touchstart', startAudio, { once: true });
    }
    
    playSound(type, frequency = 800, duration = 0.1) {
      if (!this.soundEnabled || !this.audioContext) return;
      
      try {
        if (this.audioContext.state === 'suspended') {
          this.audioContext.resume();
        }
        
        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);
        
        oscillator.type = 'sine';
        oscillator.frequency.value = frequency;
        gainNode.gain.value = 0.3;
        
        oscillator.start();
        oscillator.stop(this.audioContext.currentTime + duration);
      } catch (e) {
        console.error('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', e);
      }
    }
    
    toggleSound() {
      this.soundEnabled = !this.soundEnabled;
      return this.soundEnabled;
    }
    
    toggleBGM() {
      this.bgmEnabled = !this.bgmEnabled;
      if (this.bgMusic) {
        if (this.bgmEnabled) {
          this.bgMusic.play().catch(e => console.log('èƒŒæ™¯éŸ³ä¹æ’­æ”¾å¤±è´¥:', e));
        } else {
          this.bgMusic.pause();
        }
      }
      return this.bgmEnabled;
    }
  }
  
  class GameCore {
    constructor(state, config) {
      this.state = state;
      this.config = config;
    }
    
    generateQuestions() {
      const questions = [];
      let allNumbers = [];
      
      if (this.state.mode === 'practice') {
        const range = this.config.practiceRanges[this.state.practiceRange];
        if (!range) {
          console.error('æ— æ•ˆçš„ç»ƒä¹ èŒƒå›´:', this.state.practiceRange);
          return questions;
        }
        
        for (let num = range.min; num <= range.max; num += 100) {
          allNumbers.push(num);
        }
        
        allNumbers = allNumbers.filter(num => num % 1000 !== 0);
        this.state.totalQuestions = Math.min(range.totalQuestions || 18, allNumbers.length);
      } else {
        for (let num = 100; num <= 9900; num += 100) {
          allNumbers.push(num);
        }
        this.state.totalQuestions = Math.min(this.state.totalQuestions, allNumbers.length);
      }
      
      if (allNumbers.length === 0) {
        console.error('è¯¥èŒƒå›´å†…æ²¡æœ‰å¯ç”¨çš„æ•°å­—');
        return questions;
      }
      
      for (let i = allNumbers.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allNumbers[i], allNumbers[j]] = [allNumbers[j], allNumbers[i]];
      }
      
      for (let i = 0; i < this.state.totalQuestions && i < allNumbers.length; i++) {
        questions.push(allNumbers[i]);
      }
      
      return questions;
    }
    
    calculate95Percent(number) {
      return Math.floor(number * 0.95);
    }
    
    checkAnswer(userAnswer, correctAnswer) {
      const parsedAnswer = parseInt(userAnswer, 10);
      return !isNaN(parsedAnswer) && parsedAnswer === correctAnswer;
    }
    
    getAccuracy() {
      if (this.state.questions.length === 0) return 0;
      return Math.round((this.state.score / this.state.questions.length) * 100);
    }
    
    getAverageTime() {
      if (this.state.challengeTimes.length === 0) return 0;
      const sum = this.state.challengeTimes.reduce((a, b) => a + b, 0);
      return (sum / this.state.challengeTimes.length).toFixed(1);
    }
  }
  
  class Game {
    constructor() {
      this.state = new GameState();
      this.config = new GameConfig();
      this.dom = new DOMCache();
      this.screens = new ScreenManager(this.dom);
      this.timers = new TimerManager();
      this.audio = new AudioManager();
      this.core = new GameCore(this.state, this.config);
      this.init();
    }
    
    init() {
      this.bindEvents();
      this.setupUI();
      this.state.load();
      console.log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
    }
    
    setupUI() {
      const nicknameInput = this.dom.get('#nickname-input');
      if (nicknameInput) {
        nicknameInput.value = this.state.playerName;
      }
      
      const soundIcon = this.dom.get('#sound-icon');
      const bgmIcon = this.dom.get('#bgm-icon');
      
      if (soundIcon) {
        soundIcon.className = this.audio.soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
      }
      
      if (bgmIcon) {
        bgmIcon.className = this.audio.bgmEnabled ? 'fas fa-music' : 'fas fa-music-slash';
      }
    }
    
    bindEvents() {
      document.addEventListener('click', this.handleClick.bind(this));
      document.addEventListener('keydown', this.handleKeydown.bind(this));
      
      const answerInput = this.dom.get('#answer-input');
      if (answerInput) {
        answerInput.addEventListener('input', this.handleInput.bind(this));
      }
      
      window.addEventListener('resize', this.handleResize.bind(this));
      window.addEventListener('beforeunload', () => {
        this.timers.clearAll();
      });
    }
    
    handleClick(event) {
      const target = event.target;
      
      if (target.dataset.debouncing) return;
      target.dataset.debouncing = true;
      setTimeout(() => {
        delete target.dataset.debouncing;
      }, CONFIG.DEBOUNCE_DELAY);
      
      this.audio.playSound('button', 600, 0.1);
      
      if (target.closest('#practice-mode')) {
        this.state.mode = 'practice';
        this.screens.show('nickname');
      } else if (target.closest('#challenge-mode')) {
        this.state.mode = 'challenge';
        this.screens.show('nickname');
      } else if (target.closest('#confirm-nickname-btn')) {
        this.handleNicknameConfirm();
      } else if (target.closest('.difficulty-option')) {
        this.handleDifficultySelect(target.closest('.difficulty-option'));
      } else if (target.closest('#next-btn')) {
        this.handleNextQuestion();
      } else if (target.closest('#restart-btn')) {
        this.handleRestart();
      } else if (target.closest('#share-btn')) {
        this.handleShare();
      } else if (target.closest('#sound-toggle')) {
        const enabled = this.audio.toggleSound();
        const icon = this.dom.get('#sound-icon');
        if (icon) {
          icon.className = enabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
        }
      } else if (target.closest('#bgm-toggle')) {
        const enabled = this.audio.toggleBGM();
        const icon = this.dom.get('#bgm-icon');
        if (icon) {
          icon.className = enabled ? 'fas fa-music' : 'fas fa-music-slash';
        }
      } else if (target.closest('.back-home-btn')) {
        this.goHome();
      } else if (target.closest('.key')) {
        this.handleKeypad(target.closest('.key'));
      } else if (target.closest('#copy-btn')) {
        this.handleCopyShareText();
      } else if (target.closest('#close-modal')) {
        this.closeShareModal();
      }
    }
    
    handleKeypad(keyElement) {
      const key = keyElement.dataset.key;
      const answerInput = this.dom.get('#answer-input');
      const nextBtn = this.dom.get('#next-btn');
      
      if (!answerInput) return;
      
      if (key) {
        answerInput.value += key;
        this.audio.playSound('key', 800, 0.05);
      } else if (keyElement.id === 'backspace') {
        answerInput.value = answerInput.value.slice(0, -1);
        this.audio.playSound('key', 400, 0.05);
      } else if (keyElement.id === 'clear') {
        answerInput.value = '';
        this.audio.playSound('key', 300, 0.05);
      }
      
      if (nextBtn) {
        nextBtn.disabled = answerInput.value === '';
      }
    }
    
    handleKeydown(event) {
      const answerInput = this.dom.get('#answer-input');
      if (!answerInput) return;
      
      if (event.key >= '0' && event.key <= '9') {
        answerInput.value += event.key;
        this.audio.playSound('key', 800, 0.05);
        event.preventDefault();
      } else if (event.key === 'Backspace') {
        answerInput.value = answerInput.value.slice(0, -1);
        this.audio.playSound('key', 400, 0.05);
        event.preventDefault();
      } else if (event.key === 'Enter') {
        this.handleNextQuestion();
        event.preventDefault();
      } else if (event.key === 'Escape') {
        this.goHome();
        event.preventDefault();
      }
    }
    
    handleNicknameConfirm() {
      const nicknameInput = this.dom.get('#nickname-input');
      if (!nicknameInput) return;
      
      const nickname = nicknameInput.value.trim();
      if (nickname.length < 2 || nickname.length > 10) {
        alert('è¯·è¾“å…¥2-10ä¸ªå­—ç¬¦çš„æ˜µç§°');
        return;
      }
      
      this.state.playerName = nickname;
      localStorage.setItem(`${CONFIG.STORAGE_KEY}_nickname`, nickname);
      
      if (this.state.mode === 'practice') {
        this.screens.show('practice');
      } else {
        this.screens.show('challenge');
      }
    }
    
    handleDifficultySelect(option) {
      if (this.state.mode === 'practice') {
        const range = option.dataset.range;
        if (!range) return;
        this.state.practiceRange = parseInt(range, 10);
      } else {
        const difficulty = option.dataset.difficulty;
        if (!difficulty) return;
        this.state.difficulty = difficulty;
        const settings = this.config.difficultySettings[difficulty];
        this.state.totalQuestions = settings.totalQuestions;
        this.state.challengeTimeLeft = settings.timePerQuestion;
      }
      
      this.startGame();
    }
    
    startGame() {
      this.timers.clearAll();
      this.state.reset();
      this.state.load();
      
      this.state.questions = this.core.generateQuestions();
      if (this.state.questions.length === 0) {
        alert('æ— æ³•ç”Ÿæˆé¢˜ç›®ï¼Œè¯·é‡æ–°é€‰æ‹©èŒƒå›´');
        this.screens.show('home');
        return;
      }
      
      this.updateGameUI();
      this.screens.show('game');
      this.audio.playSound('start', 1000, 0.2);
      this.startTimer();
      
      if (this.state.mode === 'challenge') {
        this.startChallengeTimer();
      }
    }
    
    updateGameUI() {
      const questionElement = this.dom.get('#question');
      const currentQuestionElement = this.dom.get('#current-question');
      const totalQuestionsElement = this.dom.get('#total-questions');
      const answerInput = this.dom.get('#answer-input');
      const gameTitle = this.dom.get('#game-title');
      const challengeTimerContainer = this.dom.get('#challenge-timer-container');
      
      if (questionElement && this.state.questions.length > 0) {
        questionElement.textContent = this.state.questions[0];
      }
      
      if (currentQuestionElement) {
        currentQuestionElement.textContent = '1';
      }
      
      if (totalQuestionsElement) {
        totalQuestionsElement.textContent = this.state.questions.length;
      }
      
      if (answerInput) {
        answerInput.value = '';
        answerInput.style.backgroundColor = '';
      }
      
      if (gameTitle) {
        if (this.state.mode === 'challenge') {
          const difficultyName = this.config.difficultyNames[this.state.difficulty] || this.state.difficulty;
          gameTitle.innerHTML = `<i class="fas fa-trophy"></i> æŒ‘æˆ˜æ¨¡å¼ - ${difficultyName}`;
        } else {
          gameTitle.textContent = "ç»ƒä¹ æ¨¡å¼";
        }
      }
      
      if (challengeTimerContainer) {
        challengeTimerContainer.style.display = this.state.mode === 'challenge' ? 'block' : 'none';
      }
      
      this.updateProgressBar();
    }
    
    updateProgressBar() {
      const progressFill = this.dom.get('#progress-fill');
      if (!progressFill) return;
      
      const progress = ((this.state.currentQuestion - 1) / this.state.questions.length) * 100;
      progressFill.style.width = `${progress}%`;
    }
    
    startTimer() {
      this.state.startTime = Date.now();
      
      this.timers.setInterval('main', () => {
        this.state.elapsedTime = Math.floor((Date.now() - this.state.startTime) / 1000);
        this.updateTimerDisplay();
      }, 1000);
    }
    
    startChallengeTimer() {
      const challengeTimerElement = this.dom.get('#challenge-timer');
      if (challengeTimerElement) {
        challengeTimerElement.textContent = this.state.challengeTimeLeft;
      }
      
      const questionStartTime = Date.now();
      
      this.timers.setInterval('challenge', () => {
        this.state.challengeTimeLeft--;
        if (challengeTimerElement) {
          challengeTimerElement.textContent = this.state.challengeTimeLeft;
        }
        
        if (this.state.challengeTimeLeft <= 0) {
          this.timers.clear('challenge');
          const questionTime = Math.floor((Date.now() - questionStartTime) / 1000);
          this.state.challengeTimes.push(questionTime);
          this.handleNextQuestion();
        }
      }, 1000);
    }
    
    updateTimerDisplay() {
      const timerElement = this.dom.get('#timer');
      if (!timerElement) return;
      
      const minutes = Math.floor(this.state.elapsedTime / 60).toString().padStart(2, '0');
      const seconds = (this.state.elapsedTime % 60).toString().padStart(2, '0');
      timerElement.textContent = `${minutes}:${seconds}`;
    }
    
    handleNextQuestion() {
      const answerInput = this.dom.get('#answer-input');
      const userAnswer = answerInput ? answerInput.value : '';
      const currentQuestionIndex = this.state.currentQuestion - 1;
      const currentNum = this.state.questions[currentQuestionIndex];
      const correctAnswer = this.core.calculate95Percent(currentNum);
      
      this.state.userAnswers.push(userAnswer ? parseInt(userAnswer, 10) : null);
      this.state.correctAnswers.push(correctAnswer);
      
      const isCorrect = this.core.checkAnswer(userAnswer, correctAnswer);
      
      if (isCorrect) {
        this.state.score++;
        this.audio.playSound('correct', 1200, 0.1);
        if (answerInput) {
          answerInput.classList.add('pulse');
          answerInput.style.backgroundColor = '#e8f5e9';
          setTimeout(() => {
            answerInput.classList.remove('pulse');
          }, 300);
        }
      } else {
        this.state.incorrectList.push({
          question: currentNum,
          userAnswer: userAnswer ? parseInt(userAnswer, 10) : null,
          correctAnswer: correctAnswer
        });
        this.audio.playSound('wrong', 400, 0.2);
        if (answerInput) {
          answerInput.classList.add('pulse');
          answerInput.style.backgroundColor = '#ffebee';
          setTimeout(() => {
            answerInput.classList.remove('pulse');
          }, 300);
        }
      }
      
      this.state.currentQuestion++;
      
      if (this.state.currentQuestion > this.state.questions.length) {
        this.endGame();
        return;
      }
      
      this.updateToNextQuestion();
    }
    
    updateToNextQuestion() {
      const currentQuestionElement = this.dom.get('#current-question');
      const questionElement = this.dom.get('#question');
      const answerInput = this.dom.get('#answer-input');
      const nextBtn = this.dom.get('#next-btn');
      
      if (currentQuestionElement) {
        currentQuestionElement.textContent = this.state.currentQuestion;
      }
      
      if (questionElement) {
        questionElement.textContent = this.state.questions[this.state.currentQuestion - 1];
      }
      
      if (answerInput) {
        answerInput.value = '';
        answerInput.style.backgroundColor = '';
      }
      
      if (nextBtn) {
        nextBtn.disabled = true;
      }
      
      this.updateProgressBar();
      
      if (this.state.mode === 'challenge') {
        this.timers.clear('challenge');
        const settings = this.config.difficultySettings[this.state.difficulty];
        this.state.challengeTimeLeft = settings.timePerQuestion;
        this.startChallengeTimer();
      }
    }
    
    endGame() {
      this.timers.clearAll();
      this.showResults();
      this.audio.playSound('end', 600, 0.3);
      this.state.save();
    }
    
    showResults() {
      const now = new Date();
      this.state.completionTime = now.toLocaleString('zh-TW', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      
      this.updateResultUI();
      this.screens.show('result');
    }
    
    updateResultUI() {
      const totalQuestions = this.state.questions.length;
      const accuracy = this.core.getAccuracy();
      
      const resultNickname = this.dom.get('#result-nickname');
      const resultMode = this.dom.get('#result-mode');
      const resultDifficulty = this.dom.get('#result-difficulty');
      const resultDatetime = this.dom.get('#result-datetime');
      const scoreElement = this.dom.get('#score');
      const totalElement = this.dom.get('#total');
      const accuracyElement = this.dom.get('#accuracy');
      const totalTimeElement = this.dom.get('#total-time');
      const avgTimeElement = this.dom.get('#avg-time');
      const challengeResultElement = this.dom.get('#challenge-result');
      const incorrectCount = this.dom.get('#incorrect-count');
      
      if (resultNickname) resultNickname.textContent = this.state.playerName;
      if (resultMode) {
        resultMode.textContent = this.state.mode === 'practice' ? "ç»ƒä¹ æ¨¡å¼" : "æŒ‘æˆ˜æ¨¡å¼";
      }
      
      if (resultDifficulty) {
        if (this.state.mode === 'practice') {
          const range = this.config.practiceRanges[this.state.practiceRange];
          resultDifficulty.textContent = range ? range.name : '';
        } else {
          resultDifficulty.textContent = this.config.difficultyNames[this.state.difficulty] || this.state.difficulty;
        }
      }
      
      if (resultDatetime) resultDatetime.textContent = this.state.completionTime;
      if (scoreElement) scoreElement.textContent = this.state.score;
      if (totalElement) totalElement.textContent = totalQuestions;
      if (accuracyElement) accuracyElement.textContent = accuracy;
      if (incorrectCount) incorrectCount.textContent = this.state.incorrectList.length;
      
      const minutes = Math.floor(this.state.elapsedTime / 60).toString().padStart(2, '0');
      const seconds = (this.state.elapsedTime % 60).toString().padStart(2, '0');
      if (totalTimeElement) totalTimeElement.textContent = `${minutes}:${seconds}`;
      
      if (challengeResultElement) {
        if (this.state.mode === 'challenge' && this.state.challengeTimes.length > 0) {
          challengeResultElement.style.display = 'block';
          if (avgTimeElement) {
            avgTimeElement.textContent = this.core.getAverageTime();
          }
        } else {
          challengeResultElement.style.display = 'none';
        }
      }
      
      this.updateResultBadge(accuracy);
      this.updateIncorrectGrid();
    }
    
    updateResultBadge(accuracy) {
      const badgeElement = this.dom.get('#result-badge');
      if (!badgeElement) return;
      
      let badgeHTML = '';
      let badgeTitle = '';
      
      if (accuracy >= 90) {
        badgeHTML = '<i class="fas fa-crown" style="color: #FFD700;"></i>';
        badgeTitle = "ç‹è€…çº§åˆ«ï¼";
      } else if (accuracy >= 70) {
        badgeHTML = '<i class="fas fa-star" style="color: #C0C0C0;"></i>';
        badgeTitle = "è¡¨ç°ä¼˜å¼‚ï¼";
      } else if (accuracy >= 50) {
        badgeHTML = '<i class="fas fa-check-circle" style="color: #CD7F32;"></i>';
        badgeTitle = "ç»§ç»­åŠªåŠ›ï¼";
      } else {
        badgeHTML = '<i class="fas fa-redo" style="color: #8B4513;"></i>';
        badgeTitle = "å¤šåŠ ç»ƒä¹ ï¼";
      }
      
      badgeElement.innerHTML = badgeHTML;
      badgeElement.title = badgeTitle;
    }
    
    updateIncorrectGrid() {
      const incorrectGrid = this.dom.get('#incorrect-grid');
      const incorrectEmpty = this.dom.get('#incorrect-empty');
      const incorrectNavLeft = this.dom.get('#incorrect-nav-left');
      const incorrectNavRight = this.dom.get('#incorrect-nav-right');
      const incorrectScrollHint = this.dom.get('#incorrect-scroll-hint');
      
      if (!incorrectGrid || !incorrectEmpty) return;
      
      incorrectGrid.innerHTML = '';
      
      if (this.state.incorrectList.length === 0) {
        incorrectGrid.style.display = 'none';
        if (incorrectNavLeft) incorrectNavLeft.style.display = 'none';
        if (incorrectNavRight) incorrectNavRight.style.display = 'none';
        if (incorrectScrollHint) incorrectScrollHint.style.display = 'none';
        incorrectEmpty.style.display = 'flex';
        return;
      }
      
      incorrectGrid.style.display = 'flex';
      incorrectEmpty.style.display = 'none';
      
      this.state.incorrectList.forEach((item, index) => {
        const gridItem = document.createElement('div');
        gridItem.className = 'incorrect-grid-item';
        gridItem.innerHTML = `
          <div class="incorrect-grid-label">ç¬¬ ${index + 1} é¢˜</div>
          <div class="incorrect-grid-number">${item.question}</div>
          <div class="incorrect-grid-label">æ‚¨çš„ç­”æ¡ˆ</div>
          <div class="incorrect-grid-answer">${item.userAnswer !== null && item.userAnswer !== undefined ? item.userAnswer : 'æœªä½œç­”'}</div>
          <div class="incorrect-grid-label">æ­£ç¡®ç­”æ¡ˆ</div>
          <div class="incorrect-grid-correct">${item.correctAnswer}</div>
        `;
        incorrectGrid.appendChild(gridItem);
      });
      
      const showNav = this.state.incorrectList.length > 3;
      if (incorrectNavLeft) {
        incorrectNavLeft.style.display = showNav ? 'flex' : 'none';
      }
      
      if (incorrectNavRight) {
        incorrectNavRight.style.display = showNav ? 'flex' : 'none';
      }
      
      if (incorrectScrollHint) {
        incorrectScrollHint.style.display = showNav ? 'flex' : 'none';
      }
      
      this.initIncorrectGridScroll();
    }
    
    initIncorrectGridScroll() {
      const incorrectGrid = this.dom.get('#incorrect-grid');
      const leftNav = this.dom.get('#incorrect-nav-left');
      const rightNav = this.dom.get('#incorrect-nav-right');
      
      if (!incorrectGrid || !leftNav || !rightNav) return;
      
      const gridItemWidth = 180;
      const gridGap = 8;
      
      leftNav.addEventListener('click', () => {
        this.audio.playSound('button', 600, 0.1);
        incorrectGrid.scrollBy({
          left: -(gridItemWidth + gridGap),
          behavior: 'smooth'
        });
      });
      
      rightNav.addEventListener('click', () => {
        this.audio.playSound('button', 600, 0.1);
        incorrectGrid.scrollBy({
          left: gridItemWidth + gridGap,
          behavior: 'smooth'
        });
      });
    }
    
    handleRestart() {
      this.audio.playSound('button', 600, 0.1);
      if (this.state.mode === 'practice') {
        this.screens.show('practice');
      } else {
        this.screens.show('challenge');
      }
    }
    
    handleShare() {
      this.audio.playSound('button', 600, 0.1);
      
      const shareScore = this.dom.get('#share-score');
      const shareTotal = this.dom.get('#share-total');
      const shareAccuracy = this.dom.get('#share-accuracy');
      const shareText = this.dom.get('#share-text');
      const wxInstructions = this.dom.get('#wx-instructions');
      const shareModal = this.dom.get('#share-modal');
      
      if (shareScore) shareScore.textContent = this.state.score;
      if (shareTotal) shareTotal.textContent = this.state.questions.length;
      
      const totalQuestions = this.state.questions.length;
      const accuracy = totalQuestions > 0 ? Math.round((this.state.score / totalQuestions) * 100) : 0;
      if (shareAccuracy) shareAccuracy.textContent = accuracy;
      
      const shareContent = this.generateShareText();
      if (shareText) shareText.textContent = shareContent;
      
      const isWechat = /MicroMessenger/i.test(navigator.userAgent);
      if (wxInstructions) {
        wxInstructions.style.display = isWechat ? 'block' : 'none';
      }
      
      if (shareModal) shareModal.style.display = 'flex';
    }
    
    generateShareText() {
      const modeText = this.state.mode === 'challenge'
        ? `ã€æŒ‘æˆ˜æ¨¡å¼Â·${this.config.difficultyNames[this.state.difficulty] || this.state.difficulty}ã€‘`
        : 'ã€ç»ƒä¹ æ¨¡å¼ã€‘';
        
      const difficultyText = this.state.mode === 'practice'
        ? (this.config.practiceRanges[this.state.practiceRange]?.name || '')
        : (this.config.difficultyNames[this.state.difficulty] || '');
        
      const totalQuestions = this.state.questions.length;
      const accuracy = this.core.getAccuracy();
      const timeMinutes = Math.floor(this.state.elapsedTime / 60);
      const timeSeconds = this.state.elapsedTime % 60;
      
      return `ç©å®¶ï¼š${this.state.playerName}
æˆ‘åœ¨95æ•¸èƒŒæ•¸éŠæˆ²ä¸­${modeText}ï¼ˆ${difficultyText}ï¼‰ç²å¾—${this.state.score}/${totalQuestions}åˆ†ï¼
æ­£ç¢ºç‡ï¼š${accuracy}%
ç”¨æ™‚ï¼š${timeMinutes}åˆ†${timeSeconds}ç§’
å®Œæˆæ™‚é–“ï¼š${this.state.completionTime}
å¿«ä¾†æŒ‘æˆ°ä½ çš„å¿ƒç®—èƒ½åŠ›ï¼`;
    }
    
    handleCopyShareText() {
      const shareText = this.dom.get('#share-text');
      if (!shareText) return;
      
      const textToCopy = shareText.textContent;
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        this.audio.playSound('correct', 1200, 0.1);
        alert('åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
      }).catch(err => {
        console.error('è¤‡è£½å¤±æ•—:', err);
        const textArea = document.createElement('textarea');
        textArea.value = textToCopy;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        this.audio.playSound('correct', 1200, 0.1);
        alert('åˆ†äº«å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
      });
    }
    
    closeShareModal() {
      const shareModal = this.dom.get('#share-modal');
      if (shareModal) {
        shareModal.style.display = 'none';
      }
    }
    
    goHome() {
      this.timers.clearAll();
      this.audio.playSound('button', 600, 0.1);
      this.screens.show('home');
    }
    
    handleInput(event) {
      const nextBtn = this.dom.get('#next-btn');
      if (nextBtn) {
        nextBtn.disabled = !event.target.value.trim();
      }
    }
    
    handleResize() {
      this.adjustForMobile();
    }
    
    adjustForMobile() {
      const isMobile = window.innerWidth <= 480;
      const resultScreen = this.dom.get('#result-screen');
      
      if (resultScreen && isMobile) {
        resultScreen.style.overflowY = 'auto';
        resultScreen.style.webkitOverflowScrolling = 'touch';
      }
    }
  }
  
  window.addEventListener('DOMContentLoaded', () => {
    try {
      window.game = new Game();
      
      window.addEventListener('error', (event) => {
        console.error('æ¸¸æˆé”™è¯¯:', event.error);
        if (window.game && window.game.screens) {
          window.game.screens.show('home');
        }
      });
      
      window.addEventListener('unhandledrejection', (event) => {
        console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
      });
    } catch (error) {
      console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
      alert('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
  });
  
  document.addEventListener('visibilitychange', () => {
    if (document.hidden && window.game && window.game.audio) {
      window.game.audio.bgMusic.pause();
    }
  });
})();
</script>
</body>
</html>
